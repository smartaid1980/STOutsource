<!DOCTYPE html>
<html lang="en-us" id="extr-page">
  <head>
    <meta charset="utf-8" />
    <title>Login ServCloud</title>
    <meta name="description" content="" />
    <meta name="author" content="" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"
    />

    <!-- Basic Styles -->
    <!-- <link rel="stylesheet" type="text/css" media="screen" href="css/bootstrap.min.css">
  <link rel="stylesheet" type="text/css" media="screen" href="css/font-awesome.min.css"> -->

    <!-- SmartAdmin Styles : Please note (smartadmin-production.css) was created using LESS variables -->
    <!-- <link rel="stylesheet" type="text/css" media="screen" href="css/smartadmin-production.min.css">
  <link rel="stylesheet" type="text/css" media="screen" href="css/smartadmin-skins.min.css"> -->

    <!-- 上面 4 個都被壓進此內了 -->
    <link rel="stylesheet" type="text/css" media="screen" href="css/all.css" />

    <!-- ICON -->
    <link
      rel="shortcut icon"
      href="img/logo/Servcloud-icon.ico"
      type="image/x-icon"
    />
    <link rel="icon" href="img/logo/Servcloud-icon.ico" type="image/x-icon" />

    <!-- SmartAdmin RTL Support is under construction
     This RTL CSS will be released in version 1.5
  <link rel="stylesheet" type="text/css" media="screen" href="css/smartadmin-rtl.min.css"> -->

    <!-- We recommend you use "your_style.css" to override SmartAdmin
     specific styles this will also ensure you retrain your customization with each SmartAdmin update.
  <link rel="stylesheet" type="text/css" media="screen" href="css/your_style.css"> -->

    <!-- Demo purpose only: goes with demo.js, you can delete this css when designing your own WebApp -->
    <!-- <link rel="stylesheet" type="text/css" media="screen" href="css/demo.min.css"> -->

    <!-- FAVICONS -->

    <!-- GOOGLE FONT
  <link rel="stylesheet" href="http://fonts.googleapis.com/css?family=Open+Sans:400italic,700italic,300,400,700">-->
  </head>

  <!-- servtech config -->
  <script src="js/libs/jquery-2.1.1.min.js"></script>
  <script src="js/servtech.config.js"></script>
  <script>
    if (!Object.prototype.hasOwnProperty.call(window, 'servtechConfig')) {
      $.ajax({
        url: './js/servtech.config.json',
        dataType: 'json',
        async: false,
        success(data) {
          window.servtechConfig = data
        },
        error(jqXHR, textStatus, e) {
          console.warn(e)
        },
      })
    }
    if (window.servtechConfig.ST_UI_SHOW_SERVLOGO === false) {
      var style = document.createElement('style')
      style.innerHTML = '.serv-info{display:none;}'
      document.head.appendChild(style)
    }
  </script>

  <body class="animated fadeInDown">
    <!-- possible classes: minified, no-right-panel, fixed-ribbon, fixed-header, fixed-width-->

    <div id="main" role="main">
      <!-- MAIN CONTENT -->
      <div id="content" class="container">
        <div class="row">
          <div
            class="col-xs-12 col-sm-12 col-md-6 col-lg-4 col-md-offset-3 col-lg-offset-4"
          >
            <div class="well no-padding">
              <form id="login-form" class="smart-form client-form">
                <header>
                  登入
                </header>

                <fieldset>
                  <div style="text-align: center; padding: 5px;">
                    <div class="mb30">
                      <img
                        src="img/logo/Servcloud-vertical.png"
                        class="serv-info"
                        style="max-width: 200px;"
                      />
                    </div>
                  </div>

                  <section>
                    <!--  <label class="label">Account</label>  -->
                    <label class="input">
                      <i class="icon-append fa fa-user"></i>
                      <input
                        id="account"
                        type="account"
                        name="account"
                        placeholder="帳號"
                        autofocus
                      />
                      <b class="tooltip tooltip-top-right">
                        <i class="fa fa-user txt-color-teal"></i>
                        <span class="enterAccount">輸入您的帳號</span>
                      </b>
                    </label>
                  </section>

                  <section>
                    <!--<label class="label">Password</label>-->
                    <label class="input">
                      <i class="icon-append fa fa-lock"></i>
                      <input
                        id="password"
                        type="password"
                        name="password"
                        placeholder="密碼"
                      />
                      <b class="tooltip tooltip-top-right">
                        <i class="fa fa-lock txt-color-teal"></i>
                        <span class="enterPassword">輸入您的密碼</span>
                      </b>
                    </label>
                  </section>

                  <section>
                    <label class="checkbox">
                      <input type="checkbox" name="remember" checked="" />
                      <i></i><span class="stay-signed-in">保持登入</span></label
                    >
                  </section>
                </fieldset>
                <footer>
                  <!--<span id="logo"><a href="http://www.servtech.com.tw/" target="blank">-->
                  <!--<img src="img/logo/Servtech-horizontal.png"></a></span>-->

                  <button type="submit" class="btn btn-primary">
                    登入
                  </button>
                </footer>
              </form>
            </div>
          </div>
        </div>
      </div>
    </div>

    <script src="js/libs/jquery-ui-1.10.3.min.js"></script>

    <!-- BOOTSTRAP JS -->
    <script src="js/bootstrap/bootstrap.min.js"></script>

    <!-- JQUERY VALIDATE -->
    <script src="js/plugin/jquery-validate/jquery.validate.min.js"></script>

    <!-- JQUERY MASKED INPUT -->
    <script src="js/plugin/masked-input/jquery.maskedinput.min.js"></script>

    <script>
      var langMap = {
        'zh-tw': {
          signIn: '登入',
          account: '帳號',
          password: '密碼',
          staySignedIn: '保持登入',
          enterAccount: '輸入您的帳號',
          enterPassword: '輸入您的密碼',
          accountWrong: '帳號錯誤!',
          passwordWrong: '密碼錯誤!',
          noPermition: '抱歉，您並無權限登入!',
          overdue: '帳號過期',
          outOfControl: '系統異常，請聯絡產品負責人!',
          pleaseAccount: '請輸入您的帳號',
          pleasePassword: '請輸入您的密碼',
        },
        'zh': {
          signIn: '登入',
          account: '帐号',
          password: '密码',
          staySignedIn: '保持登入',
          enterAccount: '输入您的帐号',
          enterPassword: '输入您的密码',
          accountWrong: '帐号错误',
          passwordWrong: '密码错误',
          noPermition: '抱歉，您并无权限登入',
          overdue: '帐号过期',
          outOfControl: '系统异常，请联络产品负责人!',
          pleaseAccount: '请输入您的帐号',
          pleasePassword: '请输入您的密码',
        },
        'en-us': {
          signIn: 'Sign In',
          account: 'Account',
          password: 'Password',
          staySignedIn: 'Stay signed in',
          enterAccount: 'Enter your account',
          enterPassword: 'Enter your password',
          accountWrong: 'Account wrong!',
          passwordWrong: 'Password wrong!',
          noPermition: 'Sorry, you have no permission!',
          overdue: 'Over time it can not be used!',
          outOfControl: 'Out of control, please contact product owner!',
          pleaseAccount: 'Please enter your account.',
          pleasePassword: 'Please enter your password again.',
        },
        'en': {
          signIn: 'Sign In',
          account: 'Account',
          password: 'Password',
          staySignedIn: 'Stay signed in',
          enterAccount: 'Enter your account',
          enterPassword: 'Enter your password',
          accountWrong: 'Account wrong!',
          passwordWrong: 'Password wrong!',
          noPermition: 'Sorry, you have no permission!',
          overdue: 'Over time it can not be used!',
          outOfControl: 'Out of control, please contact product owner!',
          pleaseAccount: 'Please enter your account.',
          pleasePassword: 'Please enter your password again.',
        },
      }

      var language = langMap[navigator.language.toLowerCase()] || langMap['en']

      ;(function () {
        var $loginForm = $('#login-form')
        $loginForm.find('header').text(language.signIn)
        $loginForm.find('#account').attr('placeholder', language.account)
        $loginForm.find('.enterAccount').text(language.enterAccount)
        $loginForm.find('#password').attr('placeholder', language.password)
        $loginForm.find('.enterPassword').text(language.enterPassword)
        $loginForm.find('.stay-signed-in').text(language.staySignedIn)
        $loginForm.find('button[type=submit]').text(language.signIn)

        if (!navigator.language.toLowerCase().startsWith('zh')) {
          $('#logo a').attr('href', 'http://www.servtech.com.tw/en/')
        }
      })()

      var validator = $('#login-form').validate({
        // Rules for form validation
        rules: {
          account: {
            required: true,
          },
          password: {
            required: true,
            minlength: 1,
            maxlength: 20,
          },
        },

        // Messages for form validation
        messages: {
          account: {
            required: language.pleaseAccount,
          },
          password: {
            required: language.pleasePassword,
          },
        },

        // Do not change code below
        errorPlacement: function (error, element) {
          error.insertAfter(element.parent())
        },

        submitHandler: function () {
          var userId = $('#account').val()
          var userPwd = $('#password').val()

          $.ajax({
            type: 'POST',
            url: 'api/user/login',
            data: {
              id: userId,
              password: userPwd,
            },
            dataType: 'json',
          }).done(function (data) {
            if (data.type === 0) {
              if (window.sessionStorage) {
                window.sessionStorage.setItem('loginInfo', data.data)
                window.sessionStorage.setItem(
                  'loginTime',
                  (function () {
                    var date = new Date()
                    return (
                      date.getFullYear() +
                      '/' +
                      ((date.getMonth() + 1 < 10 ? '0' : '') +
                        (date.getMonth() + 1)) +
                      '/' +
                      ((date.getDate() < 10 ? '0' : '') + date.getDate()) +
                      ' ' +
                      ((date.getHours() < 10 ? '0' : '') + date.getHours()) +
                      ':' +
                      ((date.getMinutes() < 10 ? '0' : '') +
                        date.getMinutes()) +
                      ':' +
                      ((date.getSeconds() < 10 ? '0' : '') + date.getSeconds())
                    )
                  })()
                )
              }

              var strFullPath = window.document.location.href
              var strPath = window.document.location.pathname
              var pos = strFullPath.indexOf(strPath)
              var prePath = strFullPath.substring(0, pos)
              var postPath = strPath.substring(
                0,
                strPath.substr(1).indexOf('/') + 1
              )

              const params = new URLSearchParams(location.search)
              if (window.servtechConfig.ST_CUSTOMER === 'CHO') {
                window.location.href =
                  prePath +
                  postPath +
                  '/index.html#app/UtilizationStd/function/zh_tw/05_alarm_message.html'
              } else if (params.has('appId') && params.has('funcId')) {
                window.location.href = `${prePath}${postPath}/index.html#app/${params.get(
                  'appId'
                )}/function/zh_tw/${params.get('funcId')}.html`
              } else {
                window.location.href = prePath + postPath + '/index.html'
              }
            } else {
              if (data.data && data.data === '2005') {
                validator.showErrors({
                  account: language.accountWrong,
                })
              } else if (data.data && data.data === '2004') {
                validator.showErrors({
                  password: language.passwordWrong,
                })
              } else if (data.data && data.data === '2003') {
                validator.showErrors({
                  password: language.noPermition,
                })
              } else if (data.data && data.data === '4001') {
                validator.showErrors({
                  password: language.overdue,
                })
              } else {
                validator.showErrors({
                  password: language.outOfControl,
                })
              }
            }
          })
        },
      })
    </script>
  </body>
</html>
